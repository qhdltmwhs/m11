<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Socket.IO ì•Œë¦¼ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }

        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .control-panel label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .control-panel input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            margin-bottom: 12px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-connect {
            background-color: #4CAF50;
            color: white;
            flex: 1;
        }

        .btn-connect:hover {
            background-color: #45a049;
        }

        .btn-disconnect {
            background-color: #f44336;
            color: white;
            flex: 1;
        }

        .btn-disconnect:hover {
            background-color: #da190b;
        }

        .btn-clear {
            background-color: #9E9E9E;
            color: white;
            flex: 1;
        }

        .btn-clear:hover {
            background-color: #757575;
        }

        #status {
            padding: 15px;
            border-radius: 4px;
            font-weight: 600;
            margin-bottom: 20px;
            background: #f0f0f0;
            color: #666;
        }

        #notifications {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #notifications h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        #notification-list {
            list-style: none;
            padding: 0;
        }

        #notification-list li {
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #2196F3;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        #notification-list li strong {
            color: #2196F3;
        }

        #notification-list li small {
            color: #888;
            font-size: 12px;
        }

        .notification-price-change {
            border-left-color: #FF9800 !important;
        }

        .notification-price-change strong {
            color: #FF9800 !important;
        }

        .notification-new-comment {
            border-left-color: #4CAF50 !important;
        }

        .notification-new-comment strong {
            color: #4CAF50 !important;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px 20px;
        }

        .status-connected {
            background: #d4edda !important;
            color: #155724 !important;
        }

        .status-error {
            background: #f8d7da !important;
            color: #721c24 !important;
        }

        .status-disconnected {
            background: #fff3cd !important;
            color: #856404 !important;
        }

        .help-text {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-size: 14px;
            color: #1565c0;
        }

        .help-text code {
            background: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>

<body>
    <h1>ğŸ”” Socket.IO ì‹¤ì‹œê°„ ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h1>

    <div class="control-panel">
        <label for="token">Access Token:</label>
        <input type="text" id="token" placeholder="ì—¬ê¸°ì— Access Tokenì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: eyJhbGci...)">

        <div class="button-group">
            <button class="btn-connect" onclick="connect()">ğŸ”Œ ì—°ê²°</button>
            <button class="btn-disconnect" onclick="disconnect()">â›” ì—°ê²° í•´ì œ</button>
            <button class="btn-clear" onclick="clearNotifications()">ğŸ—‘ï¸ ì•Œë¦¼ ì§€ìš°ê¸°</button>
        </div>
    </div>

    <div id="status">
        ìƒíƒœ: â³ ì—°ê²° ëŒ€ê¸° ì¤‘
    </div>

    <div id="notifications">
        <h2>ğŸ“¬ ë°›ì€ ì•Œë¦¼ (<span id="notification-count">0</span>)</h2>
        <ul id="notification-list">
            <div class="empty-state">
                ì•„ì§ ë°›ì€ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                ìœ„ì—ì„œ ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•˜ê³  ì•Œë¦¼ì„ ê¸°ë‹¤ë ¤ë³´ì„¸ìš”!
            </div>
        </ul>
    </div>

    <div class="help-text">
        <strong>ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong><br>
        1. <code>POST /auth/login</code>ë¡œ ë¡œê·¸ì¸í•˜ì—¬ Access Tokenì„ ë³µì‚¬í•˜ì„¸ìš”.<br>
        2. ìœ„ ì…ë ¥ë€ì— Access Tokenì„ ë¶™ì—¬ë„£ê³  "ì—°ê²°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.<br>
        3. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €/íƒ­ì—ì„œ ëŒ“ê¸€ì„ ì‘ì„±í•˜ê±°ë‚˜ ìƒí’ˆ ê°€ê²©ì„ ë³€ê²½í•˜ë©´ ì‹¤ì‹œê°„ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤!<br>
        <br>
        <strong>âœ¨ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:</strong><br>
        â€¢ <strong>ëŒ“ê¸€ ì•Œë¦¼:</strong> ë‚´ ê²Œì‹œê¸€ì— ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ëŒ“ê¸€ ì‘ì„±<br>
        â€¢ <strong>ê°€ê²© ë³€ê²½ ì•Œë¦¼:</strong> ë‚´ê°€ ì¢‹ì•„ìš”í•œ ìƒí’ˆì˜ ê°€ê²©ì´ ë³€ê²½ë¨
    </div>

    <script>
        let socket = null;
        let notificationCount = 0;

        function connect() {
            const token = document.getElementById('token').value.trim();
            if (!token) {
                alert('âš ï¸ Access Tokenì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            if (socket) {
                socket.disconnect();
            }

            updateStatus('â³ ì—°ê²° ì¤‘...', '');

            socket = io('http://localhost:3000', {
                auth: { token }
            });

            socket.on('connect', () => {
                console.log('âœ… Socket.IO connected');
                updateStatus('âœ… ì—°ê²°ë¨ - ì‹¤ì‹œê°„ ì•Œë¦¼ì„ ë°›ì„ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'status-connected');
            });

            socket.on('notification', (notification) => {
                console.log('ğŸ“¬ ì•Œë¦¼ ë°›ìŒ:', notification);
                addNotification(notification);

                // ë¸Œë¼ìš°ì € ì•Œë¦¼
                if (Notification.permission === 'granted') {
                    new Notification('ğŸ”” ìƒˆ ì•Œë¦¼', {
                        body: notification.message,
                        icon: 'ğŸ””'
                    });
                }
            });

            socket.on('connect_error', (error) => {
                console.error('âŒ Connection error:', error);
                updateStatus(`âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'status-error');
            });

            socket.on('disconnect', () => {
                console.log('ğŸ”Œ Socket.IO disconnected');
                updateStatus('ğŸ”Œ ì—°ê²° í•´ì œë¨', 'status-disconnected');
            });

            // ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
            if (Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                updateStatus('â³ ì—°ê²° ëŒ€ê¸° ì¤‘', '');
            }
        }

        function updateStatus(message, className) {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = `ìƒíƒœ: ${message}`;
            statusEl.className = className;
        }

        function addNotification(notification) {
            const list = document.getElementById('notification-list');

            // ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ ì œê±°
            const emptyState = list.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }

            const item = document.createElement('li');

            // ì•Œë¦¼ íƒ€ì…ì— ë”°ë¼ í´ë˜ìŠ¤ ì¶”ê°€
            if (notification.type === 'PRICE_CHANGE') {
                item.className = 'notification-price-change';
            } else if (notification.type === 'NEW_COMMENT') {
                item.className = 'notification-new-comment';
            }

            const typeEmoji = notification.type === 'PRICE_CHANGE' ? 'ğŸ’°' : 'ğŸ’¬';

            item.innerHTML = `
                ${typeEmoji} <strong>[${notification.type}]</strong> ${notification.message}
                <br><small>â° ${new Date(notification.createdAt).toLocaleString('ko-KR')}</small>
            `;
            list.insertBefore(item, list.firstChild);

            // ì¹´ìš´íŠ¸ ì¦ê°€
            notificationCount++;
            document.getElementById('notification-count').textContent = notificationCount;
        }

        function clearNotifications() {
            const list = document.getElementById('notification-list');
            list.innerHTML = `
                <div class="empty-state">
                    ì•„ì§ ë°›ì€ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                    ìœ„ì—ì„œ ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•˜ê³  ì•Œë¦¼ì„ ê¸°ë‹¤ë ¤ë³´ì„¸ìš”!
                </div>
            `;
            notificationCount = 0;
            document.getElementById('notification-count').textContent = '0';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ì €ì¥ ê¸°ëŠ¥
        window.addEventListener('load', () => {
            const savedToken = localStorage.getItem('socketTestToken');
            if (savedToken) {
                document.getElementById('token').value = savedToken;
            }
        });

        // í† í° ì…ë ¥ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
        document.getElementById('token').addEventListener('change', (e) => {
            localStorage.setItem('socketTestToken', e.target.value);
        });
    </script>
</body>

</html>
