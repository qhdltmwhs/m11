# m11

---

## 전체 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                         개발자 PC                                │
│                                                                 │
│   코드 작성 → git push → PR 생성 → Merge to main                   │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                          GitHub                                 │
│                                                                 │
│   ┌─────────────┐              ┌─────────────┐                  │
│   │ PR 이벤트     │              │ Push 이벤트  │                  │
│   │ (test.yml)  │              │ (deploy.yml)│                  │
│   └──────┬──────┘              └──────┬──────┘                  │
│          │                            │                         │
│          ▼                            ▼                         │
│   ┌─────────────┐              ┌─────────────┐                  │
│   │ npm test    │              │ SSH → EC2   │                  │
│   │ 테스트 실행    │              │ Docker 배포  │                  │
│   └─────────────┘              └──────┬──────┘                  │
└──────────────────────────────────────┼──────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────┐
│                        AWS EC2                                  │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                    Docker Engine                         │  │
│   │                                                          │  │
│   │   ┌──────────────┐        ┌──────────────┐               │  │
│   │   │ pandamarket- │        │ pandamarket- │               │  │
│   │   │     db       │◄──────►│     app      │◄─── :3000     │  │
│   │   │ (PostgreSQL) │        │  (Express)   │               │  │
│   │   └──────────────┘        └──────────────┘               │  │
│   │         │                        │                       │  │
│   │         ▼                        ▼                       │  │
│   │   [postgres_data]          [./uploads]                   │  │
│   │      Volume                   Volume                     │  │
│   └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## Docker 네트워크 (포트 매핑)

```
┌─────────────────────────────────────────────────────────────────┐
│  EC2 호스트 머신                                                   │
│                                                                 │
│   ┌─────────┐       ┌────────────────────────────────────────┐  │
│   │  nginx  │       │     Docker 내부 네트워크 (bridge)         │  │
│   │  :80    │       │                                        │  │
│   └────┬────┘       │   ┌────────────┐    ┌─────────────┐    │  │
│        │            │   │  Express   │    │ PostgreSQL  │    │  │
│        │            │   │   :3000    │    │   :5432     │    │  │
│        ▼            │   └────────────┘    └─────────────┘    │  │
│   localhost:3000 ◄──┼── 포트 매핑 (3000:3000)                  │  │
│                     │                                        │  │
│                     └────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```
